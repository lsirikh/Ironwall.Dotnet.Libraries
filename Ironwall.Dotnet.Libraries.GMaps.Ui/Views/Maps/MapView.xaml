<UserControl
	x:Class="Ironwall.Dotnet.Libraries.GMaps.Ui.Views.Maps.MapView"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:b="http://schemas.microsoft.com/xaml/behaviors"
	xmlns:behavior="clr-namespace:Ironwall.Dotnet.Libraries.Utils.Behaviors;assembly=Ironwall.Dotnet.Libraries.Utils"
	xmlns:cal="http://caliburnmicro.com"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:gmap="clr-namespace:Ironwall.Dotnet.Libraries.GMaps.Ui.GMapCustoms"
	xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
	xmlns:local="clr-namespace:Ironwall.Dotnet.Libraries.GMaps.Ui.Views.Maps"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:md="http://materialdesigninxaml.net/winfx/xaml/themes"
	xmlns:utils="clr-namespace:Ironwall.Dotnet.Libraries.Utils;assembly=Ironwall.Dotnet.Libraries.Utils"
	d:Background="WhiteSmoke"
	d:DesignHeight="450"
	d:DesignWidth="800"
	FontFamily="{DynamicResource MaterialDesignFont}"
	mc:Ignorable="d">
	<UserControl.Resources>
		<Style
			x:Name="CustomIconButton"
			BasedOn="{StaticResource MaterialDesignIconButton}"
			TargetType="Button">
			<Setter Property="Padding" Value="0" />
			<Setter Property="VerticalAlignment" Value="Center" />
			<Setter Property="HorizontalAlignment" Value="Center" />
			<Setter Property="Effect">
				<Setter.Value>
					<DropShadowEffect
						BlurRadius="5"
						Direction="-90"
						RenderingBias="Quality"
						ShadowDepth="5"
						Color="Black" />
				</Setter.Value>
			</Setter>
		</Style>
		<Style
			x:Name="CustomSlider"
			BasedOn="{StaticResource MaterialDesign3.MaterialDesignDiscreteSlider}"
			TargetType="Slider">
			<Setter Property="VerticalAlignment" Value="Center" />
			<Setter Property="Effect">
				<Setter.Value>
					<DropShadowEffect
						BlurRadius="10"
						Direction="-90"
						RenderingBias="Quality"
						ShadowDepth="5"
						Color="Black" />
				</Setter.Value>
			</Setter>
		</Style>
	</UserControl.Resources>
	<Grid x:Name="MapView_OuterGrid">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
			<!--<RowDefinition Height="50"/>-->
		</Grid.RowDefinitions>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="280" />
			<ColumnDefinition Width="*" />
		</Grid.ColumnDefinitions>

		<Menu
			Grid.Row="0"
			Grid.ColumnSpan="2"
			Margin="50,0,0,0"
			Background="{DynamicResource MaterialDesignPaper}"
			IsMainMenu="True"
			Style="{StaticResource MaterialDesignMenu}">

			<!--  File 메뉴  -->
			<MenuItem Header="_File">
				<MenuItem
					Command="{Binding LoadMapImageCommand}"
					Header="맵 불러오기"
					Icon="{md:PackIcon Kind=Map}"
					InputGestureText="Ctrl+L">
					<MenuItem.InputBindings>
						<KeyBinding
							Key="L"
							Command="{Binding LoadCustomMapCommand}"
							Modifiers="Ctrl" />
					</MenuItem.InputBindings>
				</MenuItem>

				<MenuItem
					Command="{Binding CreateCustomMapCommand}"
					Header="새 커스텀 맵 생성"
					Icon="{md:PackIcon Kind=MapPlus}"
					InputGestureText="Ctrl+N">
					<MenuItem.InputBindings>
						<KeyBinding
							Key="N"
							Command="{Binding CreateCustomMapCommand}"
							Modifiers="Ctrl" />
					</MenuItem.InputBindings>
				</MenuItem>

				<MenuItem
					Command="{Binding SetMapTileFolderCommand}"
					Header="맵 타일 폴더 설정"
					Icon="{md:PackIcon Kind=Mapbox}"
					InputGestureText="Ctrl+D">
					<MenuItem.InputBindings>
						<KeyBinding
							Key="D"
							Command="{Binding SetMapTileFolderCommand}"
							Modifiers="Ctrl" />
					</MenuItem.InputBindings>
				</MenuItem>

				<Separator />

				<MenuItem
					Command="{Binding ExitApplicationCommand}"
					Header="Exit"
					Icon="{md:PackIcon Kind=ExitToApp}"
					InputGestureText="Ctrl+E">
					<MenuItem.InputBindings>
						<KeyBinding
							Key="E"
							Command="{Binding ExitApplicationCommand}"
							Modifiers="Ctrl" />
					</MenuItem.InputBindings>
				</MenuItem>
			</MenuItem>
			<MenuItem Header="_Maps">
				<MenuItem
					Command="{Binding ToggleWGS84Command}"
					Header="WGS-84 좌표계"
					IsCheckable="True"
					IsChecked="{Binding IsShowWSG84, UpdateSourceTrigger=PropertyChanged}">
					<MenuItem.InputBindings>
						<KeyBinding Command="{Binding ToggleWGS84Command}" />
					</MenuItem.InputBindings>
				</MenuItem>
				<MenuItem
					Command="{Binding ToggleMGRSCommand}"
					Header="MGRS 좌표계"
					IsCheckable="True"
					IsChecked="{Binding IsShowMGRS, UpdateSourceTrigger=PropertyChanged}">
					<MenuItem.InputBindings>
						<KeyBinding Command="{Binding ToggleMGRSCommand}" />
					</MenuItem.InputBindings>
				</MenuItem>
				<MenuItem
					Command="{Binding ToggleUTMCommand}"
					Header="UTM 좌표계"
					IsCheckable="True"
					IsChecked="{Binding IsShowUTM, UpdateSourceTrigger=PropertyChanged}">
					<MenuItem.InputBindings>
						<KeyBinding Command="{Binding ToggleUTMCommand}" />
					</MenuItem.InputBindings>
				</MenuItem>
			</MenuItem>
		</Menu>

		<ToolBarTray
			Grid.Row="1"
			Grid.Column="0"
			Grid.ColumnSpan="2"
			Margin="50,0,0,0"
			md:ThemeAssist.Theme="Inherit">
			<ToolBar ClipToBounds="True" Style="{StaticResource MaterialDesignToolBar}">
				<!--  기존 버튼들  -->
				<Button Command="{Binding MoveHomeLocationCommand}" ToolTip="홈 위치 이동">
					<Button.InputBindings>
						<KeyBinding Key="Home" />
					</Button.InputBindings>
					<md:PackIcon Kind="Home" />
				</Button>

				<Button Command="{Binding SetHomeLocationCommand}" ToolTip="홈 위치 설정">
					<Button.InputBindings>
						<KeyBinding Key="Home" />
					</Button.InputBindings>
					<md:PackIcon Kind="HomeEdit" />
				</Button>

				<Button
					Command="{Binding FineRotateCommand}"
					CommandParameter="-5"
					ToolTip="5도 반시계방향 회전 (Ctrl+←)">
					<Button.InputBindings>
						<KeyBinding Key="Left" Modifiers="Ctrl" />
					</Button.InputBindings>
					<StackPanel Orientation="Horizontal">
						<md:PackIcon
							Width="16"
							Height="16"
							Kind="RotateLeft" />
						<TextBlock
							Margin="2,0,0,0"
							VerticalAlignment="Center"
							FontSize="8"
							Text="5°" />
					</StackPanel>
				</Button>

				<Button
					Command="{Binding FineRotateCommand}"
					CommandParameter="0.1"
					ToolTip="1도 반시계방향 회전">
					<StackPanel Orientation="Horizontal">
						<md:PackIcon
							Width="14"
							Height="14"
							Kind="RotateLeft" />
						<TextBlock
							Margin="2,0,0,0"
							VerticalAlignment="Center"
							FontSize="8"
							Text="0.1°" />
					</StackPanel>
				</Button>

				<Button
					Command="{Binding FineRotateCommand}"
					CommandParameter="-0.1"
					ToolTip="1도 시계방향 회전">
					<StackPanel Orientation="Horizontal">
						<md:PackIcon
							Width="14"
							Height="14"
							Kind="RotateRight" />
						<TextBlock
							Margin="2,0,0,0"
							VerticalAlignment="Center"
							FontSize="8"
							Text="0.1°" />
					</StackPanel>
				</Button>

				<Button
					Command="{Binding FineRotateCommand}"
					CommandParameter="5"
					ToolTip="5도 시계방향 회전 (Ctrl+→)">
					<Button.InputBindings>
						<KeyBinding Key="Right" Modifiers="Ctrl" />
					</Button.InputBindings>
					<StackPanel Orientation="Horizontal">
						<md:PackIcon
							Width="16"
							Height="16"
							Kind="RotateRight" />
						<TextBlock
							Margin="2,0,0,0"
							VerticalAlignment="Center"
							FontSize="8"
							Text="5°" />
					</StackPanel>
				</Button>

				<Button Command="{Binding ResetRotationCommand}" ToolTip="회전 초기화 (Ctrl+R)">
					<Button.InputBindings>
						<KeyBinding Key="R" Modifiers="Ctrl" />
					</Button.InputBindings>
					<md:PackIcon Kind="Restore" />
				</Button>

				<!--  회전 상태 표시  -->
				<TextBlock
					Margin="10,0"
					VerticalAlignment="Center"
					FontSize="11"
					Text="{Binding CurrentRotation, StringFormat='회전: {0:F1}°'}">
					<TextBlock.Style>
						<Style TargetType="TextBlock">
							<Setter Property="Foreground" Value="Gray" />
							<Style.Triggers>
								<DataTrigger Binding="{Binding IsRotated}" Value="True">
									<Setter Property="Foreground" Value="Orange" />
									<Setter Property="FontWeight" Value="Bold" />
								</DataTrigger>
							</Style.Triggers>
						</Style>
					</TextBlock.Style>
				</TextBlock>


				<Separator />

				<!--  편집 모드 섹션  -->
				<ToggleButton
					x:Name="EditModeToggle"
					IsChecked="{Binding IsEditModeEnabled}"
					Style="{StaticResource MaterialDesignSwitchToggleButton}"
					ToolTip="편집 모드 전환 (E)">
					<ToggleButton.InputBindings>
						<KeyBinding Key="E" Modifiers="Ctrl" />
					</ToggleButton.InputBindings>
					<md:PackIcon Kind="Draw" />
				</ToggleButton>

				<!--  선택된 항목 편집 버튼  -->
				<Button
					Command="{Binding EditSelectedItemsCommand}"
					IsEnabled="{Binding IsEditModeEnabled}"
					ToolTip="객체 선택/편집 (클릭)">
					<md:PackIcon Kind="VectorSquareEdit" />
				</Button>

				<!--  선택 해제 버튼  -->
				<Button
					Command="{Binding ClearSelectionCommand}"
					IsEnabled="{Binding HasSelectedItem}"
					ToolTip="선택 해제 (Esc)">
					<Button.InputBindings>
						<KeyBinding Key="Escape" />
					</Button.InputBindings>
					<md:PackIcon Kind="SelectionOff" />
				</Button>

				<!--  삭제 버튼  -->
				<Button
					Command="{Binding DeleteSelectedCommand}"
					IsEnabled="{Binding HasSelectedItem}"
					ToolTip="선택 항목 삭제 (Del)">
					<Button.InputBindings>
						<KeyBinding Key="Delete" />
					</Button.InputBindings>
					<md:PackIcon Kind="Delete" />
				</Button>

				<Separator />

				<!--  상태 표시  -->
				<TextBlock Margin="10,0" VerticalAlignment="Center">
					<TextBlock.Style>
						<Style TargetType="TextBlock">
							<Setter Property="Text" Value="일반 모드" />
							<Style.Triggers>
								<DataTrigger Binding="{Binding IsEditModeEnabled}" Value="True">
									<Setter Property="Text" Value="편집 모드" />
									<Setter Property="Foreground" Value="Orange" />
									<Setter Property="FontWeight" Value="Bold" />
								</DataTrigger>
							</Style.Triggers>
						</Style>
					</TextBlock.Style>
				</TextBlock>
			</ToolBar>
		</ToolBarTray>


		<gmap:GMapCustomControl
			x:Name="MainMap"
			Grid.Row="3"
			Grid.ColumnSpan="2"
			MaxZoom="19"
			MinZoom="2"
			ShowMGRSGrid="{Binding IsShowMGRSGrid, UpdateSourceTrigger=PropertyChanged}">
			<!--<b:Interaction.Behaviors>
				<behavior:MousePointerChangeBehavior CursorImagePath="{Binding CurrentCursorImagePath}" />
			</b:Interaction.Behaviors>-->
		</gmap:GMapCustomControl>

		<Border
			x:Name="MapView_Scale"
			Grid.Row="2"
			Margin="50,5,5,5"
			Padding="5"
			HorizontalAlignment="Left"
			VerticalAlignment="Bottom"
			Background="#88FFFFFF"
			BorderBrush="Gray"
			BorderThickness="1"
			CornerRadius="5">

			<Grid
				Grid.Column="3"
				Margin="5"
				HorizontalAlignment="Center"
				VerticalAlignment="Center">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="40" />
					<ColumnDefinition Width="100" />
				</Grid.ColumnDefinitions>
				<TextBlock
					Grid.Column="0"
					FontSize="12"
					FontWeight="Bold"
					Foreground="Black"
					Text="{Binding Scale, FallbackValue=100m}" />
				<Polyline
					Grid.Column="1"
					HorizontalAlignment="Center"
					VerticalAlignment="Center"
					Points="{Binding ScalePoints}"
					Stroke="Black"
					StrokeThickness="2" />
			</Grid>
		</Border>

		<Border
			x:Name="MapView_GeoInformation"
			Grid.Row="2"
			Grid.ColumnSpan="2"
			Margin="50,5,5,5"
			Padding="5"
			HorizontalAlignment="Left"
			VerticalAlignment="Top"
			Background="#88FFFFFF"
			BorderBrush="Gray"
			BorderThickness="1"
			CornerRadius="5">

			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
					<RowDefinition Height="Auto" />
				</Grid.RowDefinitions>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="5*" />
					<ColumnDefinition Width="2*" />
					<ColumnDefinition Width="2*" />
				</Grid.ColumnDefinitions>
				<!--  WSG-84  -->
				<Grid
					Grid.Row="0"
					Margin="5"
					VerticalAlignment="Center"
					Visibility="{Binding IsShowWSG84, Converter={StaticResource BooleanToVisibilityConverter}}">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="60" />
						<ColumnDefinition Width="80" />
						<ColumnDefinition Width="10" />
						<ColumnDefinition Width="80" />
					</Grid.ColumnDefinitions>
					<TextBlock
						Grid.Column="0"
						FontSize="12"
						FontWeight="Bold"
						Text="WSG-84: " />
					<TextBlock
						Grid.Column="1"
						FontSize="12"
						FontWeight="Bold"
						Text="{Binding CurrentCoordinatePosition.Latitude, StringFormat=F8}" />
					<TextBlock
						Grid.Column="2"
						HorizontalAlignment="Left"
						FontSize="12"
						FontWeight="Bold"
						Text="," />
					<TextBlock
						Grid.Column="3"
						FontSize="12"
						FontWeight="Bold"
						Text="{Binding CurrentCoordinatePosition.Longitude, StringFormat=F8}" />
				</Grid>
				<Grid
					Grid.Row="1"
					Margin="5"
					VerticalAlignment="Center"
					Visibility="{Binding IsShowMGRS, Converter={StaticResource BooleanToVisibilityConverter}}">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="60" />
						<ColumnDefinition Width="235" />
					</Grid.ColumnDefinitions>
					<TextBlock
						Grid.Column="0"
						FontSize="12"
						FontWeight="Bold"
						Text="MGRS: " />
					<TextBlock
						Grid.Column="1"
						FontSize="12"
						FontWeight="Bold"
						Text="{Binding CurrentMGRS}" />
				</Grid>

				<Grid
					Grid.Row="2"
					Margin="5"
					VerticalAlignment="Center"
					Visibility="{Binding IsShowUTM, Converter={StaticResource BooleanToVisibilityConverter}}">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="60" />
						<ColumnDefinition Width="235" />
					</Grid.ColumnDefinitions>
					<TextBlock
						Grid.Column="0"
						FontSize="12"
						FontWeight="Bold"
						Text="UTM: " />
					<TextBlock
						Grid.Column="1"
						FontSize="12"
						FontWeight="Bold"
						Text="{Binding CurrentUTM}" />
				</Grid>

			</Grid>
		</Border>

		<Border
			x:Name="MapView_ZoomAndRotateController"
			Grid.Row="2"
			Grid.ColumnSpan="2"
			Width="250"
			Margin="5,5,300,5"
			Padding="5"
			HorizontalAlignment="Right"
			VerticalAlignment="Bottom"
			Background="#88FFFFFF"
			BorderBrush="Gray"
			BorderThickness="1"
			CornerRadius="5">

			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="45" />
					<ColumnDefinition Width="45" />
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="45" />
				</Grid.ColumnDefinitions>
				<TextBlock
					Grid.Column="0"
					HorizontalAlignment="Center"
					VerticalAlignment="Center"
					FontSize="15"
					FontWeight="Bold"
					Text="{Binding MainMap.Zoom, FallbackValue=11}" />
				<Button
					x:Name="ZoomUp"
					Grid.Column="3"
					cal:Message.Attach="[Event Click] = [Action OnClickZoomUp($source, $eventArgs)]"
					Content="{md:PackIcon Kind=MagnifyPlus}" />
				<Slider
					x:Name="SliderZoom"
					Grid.Column="2"
					Maximum="{Binding MainMap.MaxZoom, UpdateSourceTrigger=PropertyChanged}"
					Minimum="{Binding MainMap.MinZoom, UpdateSourceTrigger=PropertyChanged}"
					SmallChange="1"
					TickPlacement="Both"
					ToolTip="{Binding MainMap.Zoom, UpdateSourceTrigger=PropertyChanged}"
					Value="{Binding MainMap.Zoom, UpdateSourceTrigger=PropertyChanged}" />
				<Button
					x:Name="ZoomDown"
					Grid.Column="1"
					cal:Message.Attach="[Event Click] = [Action OnClickZoomDown($source, $eventArgs)]"
					Content="{md:PackIcon Kind=MagnifyMinus}" />
			</Grid>
		</Border>
	</Grid>
</UserControl>
